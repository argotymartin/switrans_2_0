image: erneyvargasdev/flutter-image:3.22.0

variables:
  GIT_DEPTH: "0"

stages:
  - lints
  - deploy

lints:
  stage: lints
  script:
    - cd /home/erneyvargas/docker/switrans_2_0
    - docker container run -v $(pwd):/app erneyvargasdev/flutter-image:3.22.0 flutter pub get flutter analyze

deploy:
  stage: deploy
  script:
    - cd /home/erneyvargas/docker/switrans_2_0
    - "credeciales=\"$GIT_USER:$GIT_USER_CLAVE@\""
    - "ruta=$(git config --get remote.origin.url | sed \"s/:\\/\\//:\\/\\/$credeciales/g\")"
    - "echo $ruta"
    - "git checkout develop"
    - "git pull $ruta develop"
    - "git status"
    - "git log --oneline -n 15"
    - docker container run -v $(pwd):/app erneyvargasdev/flutter-image:3.22.0 /bin/bash -c "flutter pub get && flutter build web --wasm --no-tree-shake-icons"
    - cp -r build/web /home/erneyvargas/docker/node_centos/project_nodejs/switrans02
    - cd /home/erneyvargas/docker/node_centos
    - sh reload_node.sh
    

    
  only:
    - develop
